# Azure ARM Schema Metadata

This directory contains schema metadata and validation rules for Azure ARM resource types used in the atakora project.

## Purpose

Schema metadata files provide:

- **API Version Tracking**: Document which ARM API versions are currently used
- **Constraint Documentation**: Detailed constraints for resource properties (length, pattern, ranges)
- **Validation Rules**: Business rules and validation logic beyond basic type checking
- **Change Tracking**: Version history and breaking changes between API versions
- **Reference Links**: Links to official Azure documentation

## File Format

Each schema metadata file follows a JSON schema format with the following structure:

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Resource Provider Schema Metadata",
  "version": "YYYY-MM-DD",
  "provider": "Microsoft.ResourceProvider",
  "resources": {
    "resourceType": {
      "type": "Microsoft.Provider/resourceType",
      "apiVersion": "YYYY-MM-DD",
      "constraints": { ... }
    }
  },
  "validationRules": [ ... ],
  "references": [ ... ],
  "changeLog": [ ... ]
}
```

## Available Schemas

### Microsoft.DocumentDB (Azure Cosmos DB)

- **File**: `Microsoft.DocumentDB.schema.json`
- **API Version**: 2024-08-15
- **Generated**: 2025-10-13
- **Resources**:
  - `databaseAccounts` - Cosmos DB account (globally unique, 3-44 chars, lowercase)
  - `databaseAccounts/services` - Cosmos DB services (3-50 chars)

**Key Constraints**:
- Account names: 3-44 characters, lowercase letters/numbers/hyphens
- Must start and end with letter or number
- Globally unique across Azure
- Maximum 15 tags per resource

### Microsoft.ServiceBus

- **File**: `Microsoft.ServiceBus.schema.json`
- **API Version**: 2024-01-01
- **Generated**: 2025-10-13
- **Resources**:
  - `namespaces` - Service Bus namespace (globally unique, 6-50 chars)
  - `namespaces/queues` - Service Bus queue (1-260 chars, lowercase)
  - `namespaces/topics` - Service Bus topic (1-260 chars, lowercase)
  - `namespaces/topics/subscriptions` - Topic subscription (1-50 chars)
  - `namespaces/topics/subscriptions/rules` - Subscription filter rules (1-260 chars)
  - `namespaces/AuthorizationRules` - Authorization rules (1-50 chars)

**Key Constraints**:
- Namespace names: 6-50 characters, must start with letter
- Cannot end with `-sb` or `-mgmt` (reserved suffixes)
- Cannot contain consecutive hyphens
- Globally unique across Azure
- Queue/topic names are automatically converted to lowercase

## Usage

### For Developers

Schema metadata files help you understand:
1. Valid value ranges for resource properties
2. Required vs optional properties
3. Pattern constraints (regex) for names
4. API version compatibility

### For Type Generation (Felix)

Use schema metadata to:
1. Generate comprehensive TypeScript type definitions
2. Create runtime validation functions
3. Generate helpful error messages with examples
4. Track API version changes over time

### For Validation (Runtime)

Import validation functions from `/generated/validation/`:

```typescript
import { validateDatabaseAccounts } from '@atakora/lib/generated/validation/Microsoft.DocumentDB.validators';

const result = validateDatabaseAccounts(props);
if (!result.valid) {
  result.errors.forEach(error => {
    console.error(`${error.path}: ${error.message}`);
    if (error.fix) console.log(`Fix: ${error.fix}`);
  });
}
```

## Maintenance

### Updating Schemas

When Azure releases new ARM API versions:

1. Download the latest ARM schema from Azure's schema repository
2. Parse the schema to extract constraints and properties
3. Update the corresponding `.schema.json` file
4. Add an entry to the `changeLog` section
5. Regenerate TypeScript types and validators
6. Update construct implementations if breaking changes exist

### Adding New Resource Providers

To add a new resource provider:

1. Create `Microsoft.Provider.schema.json` in this directory
2. Follow the existing file structure
3. Document all resource types and constraints
4. Generate TypeScript types in `/generated/types/`
5. Generate validators in `/generated/validation/`
6. Update this README with the new provider information

## Validation Rule Severities

- **error**: Deployment will fail if violated
- **warning**: Deployment may succeed but best practices are violated
- **info**: Informational message about behavior

## References

- [Azure ARM Template Reference](https://learn.microsoft.com/en-us/azure/templates/)
- [Azure Resource Naming Conventions](https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/resource-name-rules)
- [Azure REST API Reference](https://learn.microsoft.com/en-us/rest/api/azure/)

---

**Generated by**: Felix (Schema & Validation Engineer)
**Last Updated**: 2025-10-13
**Project**: atakora - Type-safe Azure CDK
