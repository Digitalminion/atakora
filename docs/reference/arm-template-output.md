# ARM Template Output Reference

**Navigation**: [Docs Home](../README.md) > [Reference](./README.md) > ARM Template Output

---

## Overview

This reference describes the ARM (Azure Resource Manager) templates generated by Atakora synthesis. Understanding the output format helps with debugging, customization, and Azure deployment integration.

## Output Directory Structure

After running `atakora synth`, templates are written to `.atakora/arm.out/`:

```
.atakora/arm.out/
└── <package-name>/
    ├── template.json          # Main ARM template
    ├── parameters.json        # Default parameters
    ├── manifest.json         # Deployment manifest
    └── metadata.json         # Resource metadata
```

## Template Files

### template.json

The main ARM deployment template.

#### Structure

```json
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {},
  "variables": {},
  "resources": [],
  "outputs": {}
}
```

#### Example

```json
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {},
  "variables": {},
  "resources": [
    {
      "type": "Microsoft.Resources/resourceGroups",
      "apiVersion": "2021-04-01",
      "name": "rg-myapp-prod-eastus",
      "location": "eastus",
      "tags": {
        "environment": "production",
        "managedBy": "atakora",
        "project": "MyApp"
      },
      "properties": {}
    },
    {
      "type": "Microsoft.Network/virtualNetworks",
      "apiVersion": "2023-05-01",
      "name": "vnet-myapp-prod-eastus",
      "location": "eastus",
      "dependsOn": [
        "[resourceId('Microsoft.Resources/resourceGroups', 'rg-myapp-prod-eastus')]"
      ],
      "tags": {
        "environment": "production",
        "managedBy": "atakora"
      },
      "properties": {
        "addressSpace": {
          "addressPrefixes": ["10.0.0.0/16"]
        }
      }
    }
  ],
  "outputs": {}
}
```

### parameters.json

Default parameter values for the template.

```json
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {}
}
```

### manifest.json

Deployment metadata about the synthesis.

```json
{
  "packageName": "production",
  "environment": "production",
  "location": "eastus",
  "resourceCount": 5,
  "synthesisTime": "2025-10-08T12:00:00.000Z",
  "cliVersion": "1.0.0",
  "libVersion": "1.0.0",
  "cdkVersion": "1.0.0"
}
```

### metadata.json

Resource metadata for tracking and debugging.

```json
{
  "resources": [
    {
      "logicalId": "ResourceGroup",
      "type": "Microsoft.Resources/resourceGroups",
      "name": "rg-myapp-prod-eastus",
      "path": "MyStack/ResourceGroup",
      "dependencies": []
    },
    {
      "logicalId": "VNet",
      "type": "Microsoft.Network/virtualNetworks",
      "name": "vnet-myapp-prod-eastus",
      "path": "MyStack/VNet",
      "dependencies": ["ResourceGroup"]
    }
  ]
}
```

## ARM Resource Format

Each resource in the template follows this structure:

```json
{
  "type": "Microsoft.ResourceProvider/resourceType",
  "apiVersion": "YYYY-MM-DD",
  "name": "resource-name",
  "location": "region",
  "tags": {},
  "dependsOn": [],
  "properties": {}
}
```

### Common Fields

| Field | Description | Required | Example |
|-------|-------------|----------|---------|
| `type` | Azure resource type | Yes | `Microsoft.Network/virtualNetworks` |
| `apiVersion` | ARM API version | Yes | `2023-05-01` |
| `name` | Resource name | Yes | `vnet-myapp-prod-eastus` |
| `location` | Azure region | Most | `eastus` |
| `tags` | Resource tags | No | `{ "env": "prod" }` |
| `dependsOn` | Resource dependencies | No | `["resourceId(...)"]` |
| `properties` | Resource-specific properties | Yes | `{ "addressSpace": {...} }` |

## Dependency Management

Atakora automatically generates `dependsOn` arrays based on resource references:

```typescript
const rg = new ResourceGroup(this, 'RG', { location: 'eastus' });
const vnet = new VirtualNetwork(this, 'VNet', {
  resourceGroup: rg,  // Creates dependency
  addressSpace: { addressPrefixes: ['10.0.0.0/16'] }
});
```

Generated ARM:

```json
{
  "type": "Microsoft.Network/virtualNetworks",
  "dependsOn": [
    "[resourceId('Microsoft.Resources/resourceGroups', 'rg-myapp-prod-eastus')]"
  ]
}
```

## Resource ID References

Resources reference each other using ARM functions:

```json
{
  "serverFarmId": "[resourceId('Microsoft.Web/serverfarms', 'plan-myapp-prod-eastus')]",
  "subnet": {
    "id": "[resourceId('Microsoft.Network/virtualNetworks/subnets', 'vnet-myapp-prod-eastus', 'snet-app')]"
  }
}
```

## Property Resolution

TypeScript properties are resolved to ARM template values:

```typescript
const storage = new StorageAccount(this, 'Storage', {
  sku: { name: 'Standard_LRS' }
});

const container = new BlobContainer(this, 'Container', {
  storageAccount: storage  // Reference
});
```

Generated:

```json
{
  "type": "Microsoft.Storage/storageAccounts/blobServices/containers",
  "dependsOn": [
    "[resourceId('Microsoft.Storage/storageAccounts', 'stmyappprod')]"
  ],
  "name": "[concat('stmyappprod', '/default/container')]"
}
```

## Tag Inheritance

Tags are merged from parent constructs:

```typescript
class MyStack extends Stack {
  constructor(scope: App, id: string) {
    super(scope, id, {
      environment: 'production',
      location: 'eastus',
      tags: {
        project: 'MyApp',
        costCenter: 'Engineering'
      }
    });

    const rg = new ResourceGroup(this, 'RG', {
      tags: {
        component: 'network'  // Merged with stack tags
      }
    });
  }
}
```

Generated tags:

```json
{
  "tags": {
    "environment": "production",
    "managedBy": "atakora",
    "project": "MyApp",
    "costCenter": "Engineering",
    "component": "network"
  }
}
```

## Deployment Scopes

Atakora supports different deployment scopes:

### Subscription Scope

For subscription-level resources:

```json
{
  "$schema": "https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Resources/resourceGroups",
      "apiVersion": "2021-04-01",
      "name": "rg-myapp-prod-eastus",
      "location": "eastus"
    }
  ]
}
```

### Resource Group Scope

For resource group-scoped resources:

```json
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Network/virtualNetworks",
      "apiVersion": "2023-05-01",
      "name": "vnet-myapp-prod-eastus",
      "location": "eastus"
    }
  ]
}
```

## Customization

### Manual Template Edits

You can manually edit generated templates before deployment:

```bash
atakora synth
# Edit .atakora/arm.out/production/template.json
az deployment group create --template-file .atakora/arm.out/production/template.json
```

**Warning**: Manual edits are lost on next synthesis. Consider:
1. Modifying source code instead
2. Using ARM template extensions
3. Post-processing scripts

### Post-Processing

Add a script to modify templates after synthesis:

```javascript
// post-synth.js
const fs = require('fs');
const template = JSON.parse(fs.readFileSync('.atakora/arm.out/production/template.json'));

// Add custom modification
template.outputs = {
  vnetId: {
    type: 'string',
    value: '[resourceId("Microsoft.Network/virtualNetworks", "vnet-myapp-prod-eastus")]'
  }
};

fs.writeFileSync('.atakora/arm.out/production/template.json', JSON.stringify(template, null, 2));
```

Usage:

```bash
atakora synth && node post-synth.js
```

## Debugging Templates

### Validate Template

```bash
az deployment group validate \
  --resource-group rg-myapp-prod-eastus \
  --template-file .atakora/arm.out/production/template.json
```

### View Template

```bash
cat .atakora/arm.out/production/template.json | jq .
```

### Check Dependencies

```bash
cat .atakora/arm.out/production/metadata.json | jq '.resources[] | {name, dependencies}'
```

### Visualize Template

Use Azure Resource Visualizer:

```bash
# Open in browser
start .atakora/arm.out/production/template.json
```

## See Also

- [`atakora synth`](./cli/synth.md) - Generate templates
- [Synthesis Guide](../guides/fundamentals/synthesis.md)
- [Debugging Synthesis](../troubleshooting/debugging-synthesis.md)
- [ARM Template Documentation](https://learn.microsoft.com/en-us/azure/azure-resource-manager/templates/)

---

**Last Updated**: 2025-10-08
**Version**: 1.0.0
